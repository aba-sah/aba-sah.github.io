<html>
  <head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
       integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
       crossorigin=""/>
    
    <style>
      #map {
        width: 900px;
        height: 600px;
      }
    </style>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
       integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
       crossorigin=""></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    
  </head>
  <body>
    <div id="map"></div>
    <script
      /**
       * references:
       * http://zevross.com/blog/2014/10/28/tips-for-creating-leafleft-js-maps/
      */
      
      /*
      function onEachFeature(feature, marker) {
        if (feature.properties && feature.properties.title) {
          marker.bindPopup(feature.properties.title + "<br />" + feature.properties.description)
                .openPopup();
        }
      }
      */
 
      
      //var map = L.map('map').setView([55.9967, -3.2655], 10);
      var map = L.map('map'); //.setView([55.9761, -3.29465], 15);
      
      L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + 
                          '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 
                          'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          maxZoom: 18,
          id: 'mapbox/streets-v11',
          tileSize: 512,
          zoomOffset: -1,
          accessToken: 'pk.eyJ1IjoiYWJhLXNhaCIsImEiOiJja2Y0YzhidjgwNTc3MzBydnBwMGQ1NTllIn0.zeOI7q1hPCmH1xtttK_n0g'
      }).addTo(map);

      
      $.getJSON("may.geojson", function(response) {
        console.log("response", response);
        
        
        //var geojsonLayer = L.geoJSON()
        //                    //.addTo(map);
        //geojsonLayer.addData(response);

 
        var geojsonLayer = L.geoJson(response, {
        
          //onEachFeature: onEachFeature,
        
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, { 
              //icon: feature.properties.marker_symbol 
            })
            .on('mouseover', function() {
              var popup = "<h4>" + feature.properties.title + "</h4>";
              if (feature.properties.description && (feature.properties.description != ""))
                popup += "<hr><br /><i>" + feature.properties.description + "</i>";
                  
              this.bindPopup(popup)  
                  .openPopup();
            });
          }
        });
        geojsonLayer.addTo(map);
       
        map.fitBounds(geojsonLayer.getBounds(), {
          padding: [200, 200]
        });


        var covidCaterpillars = L.geoJson(response, {
            filter: function(feature, layer) {
            return feature.properties.category == "covid_caterpillar";
          },
/*      
          //onEachFeature: onEachFeature,
        
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, { 
              //icon: feature.properties.marker_symbol 
            })
            .on('mouseover', function() {
              var popup = "<h4>" + feature.properties.title + "</h4>";
              if (feature.properties.description && (feature.properties.description != ""))
                popup += "<hr><br /><i>" + feature.properties.description + "</i>";
                  
              this.bindPopup(popup)  
                  .openPopup();
            });
          }
*/
        });
        covidCaterpillars.addTo(map);

        
      });
      
      
    </script>
</body>
</html>
